# 📚 Oldtown Library Support Bot

בוט טלגרם מתקדם לניהול פניות לקוחות לספריית אולדטאון. הבוט מעביר הודעות מלקוחות לקבוצת הנהלה ומנהל threads נפרדים לכל משתמש.

## ✨ תכונות

- **העברת הודעות אוטומטית** - כל הודעה מלקוח מועברת לקבוצת הנהלה
- **ניהול threads** - כל לקוח מקבל thread נפרד בקבוצה
- **תמיכה בסוגי תוכן מגוונים** - טקסט, תמונות, מסמכים, וידאו, אודיו וסטיקרים
- **מערכת גיבוי חכמה** - שמירת נתונים בתוך הטלגרם עצמו
- **התאוששות אוטומטית** - הבוט זוכר את כל הנתונים גם אחרי הפעלה מחדש

## 🚀 התקנה על Render

### 1. הכנת הבוט

1. צור בוט חדש אצל [@BotFather](https://t.me/BotFather)
2. שמור את הטוקן שתקבל

### 2. הכנת הקבוצה

1. צור קבוצה חדשה בטלגרם
2. הפוך אותה לSuper Group
3. הוסף את הבוט כמנהל עם הרשאות מלאות
4. השג את מזהה הקבוצה:
   - העבר לבוט הודעה בקבוצה
   - בקר ב: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
   - חפש את `chat.id` (מספר שלילי)

### 3. פריסה על Render

1. התחבר ל[Render](https://render.com)
2. צור **Web Service** חדש
3. העלה את הקבצים או התחבר ל-GitHub
4. הגדר משתני סביבה:

```bash
BOT_TOKEN=your_bot_token_here
ADMIN_GROUP_ID=-1001234567890
WEBHOOK_URL=https://your-app-name.onrender.com
PORT=10000
```

5. הגדר Build Command: `pip install -r requirements.txt`
6. הגדר Start Command: `python main.py`

## 📝 משתני סביבה

| משתנה | תיאור | דוגמה |
|-------|-------|--------|
| `BOT_TOKEN` | טוקן הבוט מ-BotFather | `1234567890:ABCDEF...` |
| `ADMIN_GROUP_ID` | מזהה קבוצת הנהלה | `-1001234567890` |
| `WEBHOOK_URL` | כתובת השירות | `https://mybot.onrender.com` |
| `PORT` | פורט השירות | `10000` |

## 🔧 איך זה עובד

### עבור לקוחות
1. לקוח שולח `/start` ומקבל הודעת ברכה
2. כל הודעה שהלקוח שולח מועברת לקבוצת הנהלה
3. לקוח מקבל תשובות מהנהלה ישירות

### עבור צוות הנהלה
1. כל לקוח חדש יוצר thread נפרד בקבוצה
2. הנהלה רואה פרטי לקוח (שם, ID, שם משתמש)
3. תשובות בthread מועברות ללקוח המתאים

### מערכת הגיבוי
- הבוט שומר נתוני threads בהודעה מיוחדת בthread הGeneral
- גיבוי אוטומטי כל 10 דקות
- גיבוי מיידי כשנוצר thread חדש
- הבוט זוכר הכל גם אחרי הפעלה מחדש

## 🎯 פקודות

### לקוחות
- `/start` - התחלת שיחה עם הבוט

### מנהלים (בקבוצה)
- `/backup` - גיבוי ידני של נתוני threads

## 📊 מבנה הפרויקט

```
telegram-support-bot/
├── main.py              # קוד הבוט הראשי
├── requirements.txt     # תלויות Python
└── README.md           # התיעוד הזה
```

## 🔍 פתרון בעיות

### הבוט לא מגיב
- בדוק שהטוקן נכון במשתני הסביבה
- ודא שהבוט פעיל ב-BotFather
- בדוק שהWEBHOOK_URL נכון

### הודעות לא מועברות לקבוצה
- ודא שהבוט מנהל בקבוצה
- בדוק שמזהה הקבוצה נכון (כולל מינוס)
- ודא שהקבוצה היא Super Group

### תשובות לא מגיעות للקוחות
- בדוק שההודעות נשלחות בthread הנכון
- ודא שהלקוח לא חסם את הבוט
- בדוק את הלוגים ב-Render

### נתונים נעלמים אחרי restart
- ודא שהפונקציה `load_threads_from_group` עובדת
- בדוק שיש הודעת גיבוי בthread הGeneral
- השתמש ב-`/backup` לגיבוי ידני

## 📋 לוגים

הבוט מציג לוגים מפורטים:
- יצירת threads חדשים
- העברת הודעות
- שמירת גיבויים
- שגיאות ובעיות

ניתן לראות את הלוגים ב-Render Dashboard.

## 🔒 אבטחה

- הבוט מקבל הודעות רק מ-Private Chats
- תשובות מתקבלות רק מקבוצת הנהלה המוגדרת
- נתוני גיבוי נשמרים בטלגרם המוצפן

## 💡 טיפים

1. **ניהול הקבוצה**: השתמש בthread הGeneral למידע ניהולי
2. **מעקב אחר לקוחות**: מזהה הלקוח מופיע בכל thread
3. **גיבוי ידני**: השתמש ב-`/backup` לשמירה מיידית
4. **בדיקת מצב**: בדוק את הלוגים ב-Render להבנת מצב הבוט

## 🆘 תמיכה

אם יש בעיות:
1. בדוק את הלוגים ב-Render
2. ודא שכל משתני הסביבה מוגדרים נכון
3. בדוק שהבוט מנהל בקבוצה עם הרשאות מלאות
4. נסה `/backup` לוודא שהגיבוי עובד

---

**הבוט פותח עבור ספריית אולדטאון 📚**

*נוצר עם ❤️ באמצעות Python ו-python-telegram-bot*